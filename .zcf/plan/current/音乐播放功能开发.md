# éŸ³ä¹æ’­æ”¾åŠŸèƒ½å¼€å‘ - æ‰§è¡Œè®¡åˆ’

**åˆ›å»ºæ—¶é—´**: 2026-01-24 15:41:46
**æŠ€æœ¯æ–¹æ¡ˆ**: MyBatis-Plus + æ ‡å‡†åˆ†å±‚æ¶æ„ï¼ˆController â†’ Service â†’ Mapperï¼‰
**æ•°æ®åº“è®¾è®¡**: å®Œæ•´ç‰ˆï¼ˆ9 å¼ è¡¨ï¼‰
**åŠŸèƒ½èŒƒå›´**: éŸ³ä¹åˆ—è¡¨ã€éŸ³ä¹è¯¦æƒ…ã€æ’­æ”¾è®°å½•ã€éŸ³ä¹æ”¶è—

---

## ğŸ“‹ ç›®å½•

1. [æ•°æ®åº“è®¾è®¡](#é˜¶æ®µ-1æ•°æ®åº“è®¾è®¡)
2. [ä¾èµ–é…ç½®](#é˜¶æ®µ-2ä¾èµ–é…ç½®)
3. [MyBatis-Plus é…ç½®](#é˜¶æ®µ-3mybatis-plus-é…ç½®)
4. [ä»£ç ç”Ÿæˆ](#é˜¶æ®µ-4ä»£ç ç”Ÿæˆ)
5. [ä¸šåŠ¡é€»è¾‘å®ç°](#é˜¶æ®µ-5ä¸šåŠ¡é€»è¾‘å®ç°)
6. [æ¥å£æµ‹è¯•](#é˜¶æ®µ-6æ¥å£æµ‹è¯•)

---

## é˜¶æ®µ 1ï¼šæ•°æ®åº“è®¾è®¡

### 1.1 æ•°æ®åº“è¡¨ç»“æ„è®¾è®¡ï¼ˆ9 å¼ è¡¨ï¼‰

#### æ ¸å¿ƒè¡¨

##### 1. music (éŸ³ä¹è¡¨)
**æ–‡ä»¶**: `docs/sql/music.sql`
```sql
CREATE TABLE `music` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `title` VARCHAR(200) NOT NULL COMMENT 'æ­Œæ›²æ ‡é¢˜',
  `album_id` BIGINT DEFAULT NULL COMMENT 'ä¸“è¾‘ID',
  `category_id` BIGINT DEFAULT NULL COMMENT 'åˆ†ç±»ID',
  `duration` INT NOT NULL DEFAULT 0 COMMENT 'æ—¶é•¿(ç§’)',
  `file_url` VARCHAR(500) DEFAULT NULL COMMENT 'éŸ³ä¹æ–‡ä»¶URL',
  `cover_url` VARCHAR(500) DEFAULT NULL COMMENT 'å°é¢å›¾URL',
  `lyrics` TEXT COMMENT 'æ­Œè¯',
  `play_count` BIGINT NOT NULL DEFAULT 0 COMMENT 'æ’­æ”¾æ¬¡æ•°',
  `favorite_count` INT NOT NULL DEFAULT 0 COMMENT 'æ”¶è—æ¬¡æ•°',
  `release_date` DATE DEFAULT NULL COMMENT 'å‘è¡Œæ—¥æœŸ',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤(0-æœªåˆ é™¤ 1-å·²åˆ é™¤)',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_album` (`album_id`),
  KEY `idx_category` (`category_id`),
  KEY `idx_play_count` (`play_count`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='éŸ³ä¹è¡¨';
```

##### 2. artist (æ­Œæ‰‹è¡¨)
```sql
CREATE TABLE `artist` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `name` VARCHAR(100) NOT NULL COMMENT 'æ­Œæ‰‹åç§°',
  `avatar_url` VARCHAR(500) DEFAULT NULL COMMENT 'å¤´åƒURL',
  `description` TEXT COMMENT 'ç®€ä»‹',
  `country` VARCHAR(50) DEFAULT NULL COMMENT 'å›½å®¶/åœ°åŒº',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ­Œæ‰‹è¡¨';
```

##### 3. album (ä¸“è¾‘è¡¨)
```sql
CREATE TABLE `album` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `name` VARCHAR(200) NOT NULL COMMENT 'ä¸“è¾‘åç§°',
  `cover_url` VARCHAR(500) DEFAULT NULL COMMENT 'å°é¢URL',
  `description` TEXT COMMENT 'ä¸“è¾‘ç®€ä»‹',
  `release_date` DATE DEFAULT NULL COMMENT 'å‘è¡Œæ—¥æœŸ',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='ä¸“è¾‘è¡¨';
```

##### 4. category (åˆ†ç±»è¡¨)
```sql
CREATE TABLE `category` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `name` VARCHAR(50) NOT NULL COMMENT 'åˆ†ç±»åç§°(æµè¡Œ/æ‘‡æ»š/å¤å…¸ç­‰)',
  `sort_order` INT NOT NULL DEFAULT 0 COMMENT 'æ’åº',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='éŸ³ä¹åˆ†ç±»è¡¨';
```

##### 5. tag (æ ‡ç­¾è¡¨)
```sql
CREATE TABLE `tag` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `name` VARCHAR(50) NOT NULL COMMENT 'æ ‡ç­¾åç§°',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_name` (`name`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ ‡ç­¾è¡¨';
```

#### å…³è”è¡¨

##### 6. music_artist (éŸ³ä¹-æ­Œæ‰‹å…³è”è¡¨)
```sql
CREATE TABLE `music_artist` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `music_id` BIGINT NOT NULL COMMENT 'éŸ³ä¹ID',
  `artist_id` BIGINT NOT NULL COMMENT 'æ­Œæ‰‹ID',
  `artist_role` VARCHAR(20) DEFAULT 'singer' COMMENT 'è§’è‰²(singer-æ­Œæ‰‹/composer-ä½œæ›²/lyricist-ä½œè¯)',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_music_artist` (`music_id`, `artist_id`, `artist_role`),
  KEY `idx_music` (`music_id`),
  KEY `idx_artist` (`artist_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='éŸ³ä¹æ­Œæ‰‹å…³è”è¡¨';
```

##### 7. music_tag (éŸ³ä¹-æ ‡ç­¾å…³è”è¡¨)
```sql
CREATE TABLE `music_tag` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `music_id` BIGINT NOT NULL COMMENT 'éŸ³ä¹ID',
  `tag_id` BIGINT NOT NULL COMMENT 'æ ‡ç­¾ID',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_music_tag` (`music_id`, `tag_id`),
  KEY `idx_music` (`music_id`),
  KEY `idx_tag` (`tag_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='éŸ³ä¹æ ‡ç­¾å…³è”è¡¨';
```

#### ä¸šåŠ¡è¡¨

##### 8. play_record (æ’­æ”¾è®°å½•è¡¨)
```sql
CREATE TABLE `play_record` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `music_id` BIGINT NOT NULL COMMENT 'éŸ³ä¹ID',
  `user_id` BIGINT DEFAULT 0 COMMENT 'ç”¨æˆ·ID(æš‚æ—¶é»˜è®¤0,åç»­æ‰©å±•)',
  `play_duration` INT NOT NULL DEFAULT 0 COMMENT 'æ’­æ”¾æ—¶é•¿(ç§’)',
  `play_source` VARCHAR(50) DEFAULT NULL COMMENT 'æ’­æ”¾æ¥æº(app/web/h5)',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ’­æ”¾æ—¶é—´',
  PRIMARY KEY (`id`),
  KEY `idx_music` (`music_id`),
  KEY `idx_user` (`user_id`),
  KEY `idx_create_time` (`create_time`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ’­æ”¾è®°å½•è¡¨';
```

##### 9. favorite (æ”¶è—è¡¨)
```sql
CREATE TABLE `favorite` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `music_id` BIGINT NOT NULL COMMENT 'éŸ³ä¹ID',
  `user_id` BIGINT DEFAULT 0 COMMENT 'ç”¨æˆ·ID(æš‚æ—¶é»˜è®¤0,åç»­æ‰©å±•)',
  `is_deleted` TINYINT NOT NULL DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤(0-æ”¶è—ä¸­ 1-å·²å–æ¶ˆ)',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'æ”¶è—æ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_user_music` (`user_id`, `music_id`),
  KEY `idx_music` (`music_id`),
  KEY `idx_user` (`user_id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='æ”¶è—è¡¨';
```

### 1.2 æµ‹è¯•æ•°æ®å‡†å¤‡

**æ–‡ä»¶**: `docs/sql/test_data.sql`

```sql
-- æ’å…¥åˆ†ç±»æ•°æ®
INSERT INTO category (name, sort_order) VALUES
('æµè¡Œ', 1), ('æ‘‡æ»š', 2), ('å¤å…¸', 3), ('æ°‘è°£', 4), ('ç”µå­', 5);

-- æ’å…¥æ­Œæ‰‹æ•°æ®
INSERT INTO artist (name, country) VALUES
('å‘¨æ°ä¼¦', 'ä¸­å›½å°æ¹¾'), ('æ—ä¿Šæ°', 'æ–°åŠ å¡'), ('é™ˆå¥•è¿…', 'ä¸­å›½é¦™æ¸¯');

-- æ’å…¥ä¸“è¾‘æ•°æ®
INSERT INTO album (name, release_date) VALUES
('Jay', '2000-11-07'), ('èŒƒç‰¹è¥¿', '2001-09-14'), ('å¶æƒ ç¾', '2003-07-31');

-- æ’å…¥éŸ³ä¹æ•°æ®
INSERT INTO music (title, album_id, category_id, duration, play_count, release_date) VALUES
('æ™´å¤©', 3, 1, 269, 10000, '2003-07-31'),
('ä¸ƒé‡Œé¦™', 2, 1, 300, 8000, '2004-08-03'),
('ç¨»é¦™', 1, 4, 223, 12000, '2008-10-15');

-- æ’å…¥éŸ³ä¹-æ­Œæ‰‹å…³è”
INSERT INTO music_artist (music_id, artist_id, artist_role) VALUES
(1, 1, 'singer'), (2, 1, 'singer'), (3, 1, 'singer');
```

**é¢„æœŸç»“æœ**: æ•°æ®åº“ä¸­åŒ…å« 9 å¼ è¡¨ + æµ‹è¯•æ•°æ®

---

## é˜¶æ®µ 2ï¼šä¾èµ–é…ç½®

### 2.1 pom.xml æ·»åŠ ä¾èµ–

**æ–‡ä»¶**: `pom.xml`

**æ“ä½œ**: åœ¨ `<dependencies>` æ ‡ç­¾å†…æ·»åŠ ä»¥ä¸‹ä¾èµ–

```xml
<!-- MyBatis-Plus -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.5</version>
</dependency>

<!-- MyBatis-Plus ä»£ç ç”Ÿæˆå™¨ -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-generator</artifactId>
    <version>3.5.5</version>
</dependency>

<!-- ä»£ç ç”Ÿæˆå™¨æ¨¡æ¿å¼•æ“ -->
<dependency>
    <groupId>org.apache.velocity</groupId>
    <artifactId>velocity-engine-core</artifactId>
    <version>2.3</version>
</dependency>

<!-- Druid æ•°æ®åº“è¿æ¥æ±  -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>druid-spring-boot-starter</artifactId>
    <version>1.2.21</version>
</dependency>

<!-- Lombok ç®€åŒ–ä»£ç  -->
<dependency>
    <groupId>org.projectlombok</groupId>
    <artifactId>lombok</artifactId>
    <optional>true</optional>
</dependency>

<!-- å‚æ•°æ ¡éªŒ -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>

<!-- FastJson2 -->
<dependency>
    <groupId>com.alibaba.fastjson2</groupId>
    <artifactId>fastjson2</artifactId>
    <version>2.0.43</version>
</dependency>
```

**é¢„æœŸç»“æœ**: Maven ä¾èµ–ä¸‹è½½å®Œæˆï¼Œæ— å†²çª

---

## é˜¶æ®µ 3ï¼šMyBatis-Plus é…ç½®

### 3.1 application.yaml é…ç½®

**æ–‡ä»¶**: `src/main/resources/application.yaml`

**æ“ä½œ**: æ›¿æ¢åŸæœ‰å†…å®¹

```yaml
server:
  port: 8910

spring:
  application:
    name: wangyiyun-music

  # æ•°æ®æºé…ç½®
  datasource:
    type: com.alibaba.druid.pool.DruidDataSource
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/wangyiyun_music?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai&useSSL=false
    username: root
    password: root
    druid:
      initial-size: 5
      min-idle: 5
      max-active: 20
      max-wait: 60000
      test-while-idle: true
      validation-query: SELECT 1

# MyBatis-Plus é…ç½®
mybatis-plus:
  # XML æ–‡ä»¶ä½ç½®
  mapper-locations: classpath*:/mapper/**/*.xml
  # å®ä½“ç±»åˆ«ååŒ…è·¯å¾„
  type-aliases-package: com.naruto.wangyiyunmusic.model.entity
  configuration:
    # æ—¥å¿—è¾“å‡º
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
    # é©¼å³°è½¬ä¸‹åˆ’çº¿
    map-underscore-to-camel-case: true
  global-config:
    db-config:
      # ä¸»é”®ç±»å‹(è‡ªå¢)
      id-type: auto
      # é€»è¾‘åˆ é™¤å­—æ®µ
      logic-delete-field: isDeleted
      logic-delete-value: 1
      logic-not-delete-value: 0

# æ—¥å¿—é…ç½®
logging:
  level:
    com.naruto.wangyiyunmusic.mapper: debug
```

**é¢„æœŸç»“æœ**: é…ç½®æ–‡ä»¶æ ¼å¼æ­£ç¡®ï¼Œå¯è¿æ¥æ•°æ®åº“

### 3.2 MyBatis-Plus é…ç½®ç±»

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/config/MybatisPlusConfig.java`

```java
package com.naruto.wangyiyunmusic.config;

import com.baomidou.mybatisplus.annotation.DbType;
import com.baomidou.mybatisplus.extension.plugins.MybatisPlusInterceptor;
import com.baomidou.mybatisplus.extension.plugins.inner.PaginationInnerInterceptor;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * MyBatis-Plus é…ç½®ç±»
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Configuration
@MapperScan("com.naruto.wangyiyunmusic.mapper")
public class MybatisPlusConfig {

    /**
     * åˆ†é¡µæ’ä»¶
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor() {
        MybatisPlusInterceptor interceptor = new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```

**é¢„æœŸç»“æœ**: åˆ†é¡µæ’ä»¶ç”Ÿæ•ˆ

---

## é˜¶æ®µ 4ï¼šä»£ç ç”Ÿæˆ

### 4.1 ä»£ç ç”Ÿæˆå™¨

**æ–‡ä»¶**: `src/test/java/com/naruto/wangyiyunmusic/CodeGenerator.java`

```java
package com.naruto.wangyiyunmusic;

import com.baomidou.mybatisplus.generator.FastAutoGenerator;
import com.baomidou.mybatisplus.generator.config.OutputFile;
import com.baomidou.mybatisplus.generator.engine.VelocityTemplateEngine;

import java.util.Collections;

/**
 * MyBatis-Plus ä»£ç ç”Ÿæˆå™¨
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
public class CodeGenerator {

    public static void main(String[] args) {
        String url = "jdbc:mysql://localhost:3306/wangyiyun_music?useUnicode=true&characterEncoding=utf8&serverTimezone=Asia/Shanghai";
        String username = "root";
        String password = "root";

        FastAutoGenerator.create(url, username, password)
            // å…¨å±€é…ç½®
            .globalConfig(builder -> {
                builder.author("naruto") // ä½œè€…
                    .outputDir(System.getProperty("user.dir") + "/src/main/java") // è¾“å‡ºç›®å½•
                    .commentDate("yyyy-MM-dd"); // æ³¨é‡Šæ—¥æœŸæ ¼å¼
            })
            // åŒ…é…ç½®
            .packageConfig(builder -> {
                builder.parent("com.naruto.wangyiyunmusic") // çˆ¶åŒ…å
                    .entity("model.entity") // Entity åŒ…å
                    .mapper("mapper") // Mapper åŒ…å
                    .service("service") // Service åŒ…å
                    .serviceImpl("service.impl") // ServiceImpl åŒ…å
                    .controller("controller") // Controller åŒ…å
                    .pathInfo(Collections.singletonMap(OutputFile.xml,
                        System.getProperty("user.dir") + "/src/main/resources/mapper")); // Mapper XML ä½ç½®
            })
            // ç­–ç•¥é…ç½®
            .strategyConfig(builder -> {
                builder.addInclude("music", "artist", "album", "category", "tag",
                                 "music_artist", "music_tag", "play_record", "favorite") // è¡¨å
                    .entityBuilder()
                    .enableLombok() // å¯ç”¨ Lombok
                    .enableTableFieldAnnotation() // å¯ç”¨å­—æ®µæ³¨è§£
                    .logicDeleteColumnName("is_deleted") // é€»è¾‘åˆ é™¤å­—æ®µ
                    .controllerBuilder()
                    .enableRestStyle() // å¯ç”¨ REST é£æ ¼
                    .serviceBuilder()
                    .formatServiceFileName("%sService") // Service æ¥å£å‘½å
                    .formatServiceImplFileName("%sServiceImpl"); // ServiceImpl å‘½å
            })
            // æ¨¡æ¿å¼•æ“
            .templateEngine(new VelocityTemplateEngine())
            .execute();
    }
}
```

**æ‰§è¡Œ**: è¿è¡Œ CodeGenerator.main() æ–¹æ³•

**é¢„æœŸç»“æœ**: è‡ªåŠ¨ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶
- Entity: 9 ä¸ªå®ä½“ç±»ï¼ˆMusic, Artist, Album, Category, Tag, MusicArtist, MusicTag, PlayRecord, Favoriteï¼‰
- Mapper: 9 ä¸ª Mapper æ¥å£ + 9 ä¸ª XML æ–‡ä»¶
- Service: 9 ä¸ª Service æ¥å£ + 9 ä¸ª ServiceImpl å®ç°ç±»
- Controller: 9 ä¸ª Controller ç±»

---

## é˜¶æ®µ 5ï¼šä¸šåŠ¡é€»è¾‘å®ç°

### 5.1 ç»Ÿä¸€å“åº”å°è£…

#### 5.1.1 é€šç”¨å“åº”ç±»

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/common/Result.java`

```java
package com.naruto.wangyiyunmusic.common;

import lombok.Data;

/**
 * ç»Ÿä¸€å“åº”ç»“æœ
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Data
public class Result<T> {
    /**
     * å“åº”ç 
     */
    private Integer code;

    /**
     * å“åº”æ¶ˆæ¯
     */
    private String message;

    /**
     * å“åº”æ•°æ®
     */
    private T data;

    /**
     * æˆåŠŸå“åº”ï¼ˆæ— æ•°æ®ï¼‰
     */
    public static <T> Result<T> success() {
        return success(null);
    }

    /**
     * æˆåŠŸå“åº”ï¼ˆæœ‰æ•°æ®ï¼‰
     */
    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("æ“ä½œæˆåŠŸ");
        result.setData(data);
        return result;
    }

    /**
     * å¤±è´¥å“åº”
     */
    public static <T> Result<T> error(String message) {
        Result<T> result = new Result<>();
        result.setCode(500);
        result.setMessage(message);
        return result;
    }

    /**
     * è‡ªå®šä¹‰å“åº”
     */
    public static <T> Result<T> build(Integer code, String message, T data) {
        Result<T> result = new Result<>();
        result.setCode(code);
        result.setMessage(message);
        result.setData(data);
        return result;
    }
}
```

#### 5.1.2 å…¨å±€å¼‚å¸¸å¤„ç†

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/exception/GlobalExceptionHandler.java`

```java
package com.naruto.wangyiyunmusic.exception;

import com.naruto.wangyiyunmusic.common.Result;
import lombok.extern.slf4j.Slf4j;
import org.springframework.validation.BindException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    /**
     * å‚æ•°æ ¡éªŒå¼‚å¸¸
     */
    @ExceptionHandler(BindException.class)
    public Result<Void> handleBindException(BindException e) {
        log.error("å‚æ•°æ ¡éªŒå¤±è´¥", e);
        String message = e.getBindingResult().getFieldError().getDefaultMessage();
        return Result.error(message);
    }

    /**
     * ä¸šåŠ¡å¼‚å¸¸
     */
    @ExceptionHandler(BusinessException.class)
    public Result<Void> handleBusinessException(BusinessException e) {
        log.error("ä¸šåŠ¡å¼‚å¸¸: {}", e.getMessage());
        return Result.error(e.getMessage());
    }

    /**
     * ç³»ç»Ÿå¼‚å¸¸
     */
    @ExceptionHandler(Exception.class)
    public Result<Void> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸", e);
        return Result.error("ç³»ç»Ÿç¹å¿™ï¼Œè¯·ç¨åé‡è¯•");
    }
}
```

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/exception/BusinessException.java`

```java
package com.naruto.wangyiyunmusic.exception;

/**
 * ä¸šåŠ¡å¼‚å¸¸
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
public class BusinessException extends RuntimeException {
    public BusinessException(String message) {
        super(message);
    }
}
```

### 5.2 DTO/VO å®šä¹‰

#### 5.2.1 éŸ³ä¹è¯¦æƒ… VO

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/model/vo/MusicDetailVO.java`

```java
package com.naruto.wangyiyunmusic.model.vo;

import lombok.Data;
import java.time.LocalDate;
import java.util.List;

/**
 * éŸ³ä¹è¯¦æƒ…è§†å›¾å¯¹è±¡
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Data
public class MusicDetailVO {
    /**
     * éŸ³ä¹ID
     */
    private Long id;

    /**
     * æ­Œæ›²æ ‡é¢˜
     */
    private String title;

    /**
     * æ—¶é•¿(ç§’)
     */
    private Integer duration;

    /**
     * éŸ³ä¹æ–‡ä»¶URL
     */
    private String fileUrl;

    /**
     * å°é¢å›¾URL
     */
    private String coverUrl;

    /**
     * æ­Œè¯
     */
    private String lyrics;

    /**
     * æ’­æ”¾æ¬¡æ•°
     */
    private Long playCount;

    /**
     * æ”¶è—æ¬¡æ•°
     */
    private Integer favoriteCount;

    /**
     * å‘è¡Œæ—¥æœŸ
     */
    private LocalDate releaseDate;

    /**
     * ä¸“è¾‘åç§°
     */
    private String albumName;

    /**
     * åˆ†ç±»åç§°
     */
    private String categoryName;

    /**
     * æ­Œæ‰‹åˆ—è¡¨
     */
    private List<ArtistVO> artists;

    /**
     * æ ‡ç­¾åˆ—è¡¨
     */
    private List<String> tags;
}
```

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/model/vo/ArtistVO.java`

```java
package com.naruto.wangyiyunmusic.model.vo;

import lombok.Data;

/**
 * æ­Œæ‰‹è§†å›¾å¯¹è±¡
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Data
public class ArtistVO {
    /**
     * æ­Œæ‰‹ID
     */
    private Long id;

    /**
     * æ­Œæ‰‹åç§°
     */
    private String name;

    /**
     * è§’è‰²(singer/composer/lyricist)
     */
    private String role;
}
```

#### 5.2.2 åˆ†é¡µæŸ¥è¯¢è¯·æ±‚ DTO

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/model/dto/MusicQueryDTO.java`

```java
package com.naruto.wangyiyunmusic.model.dto;

import lombok.Data;

/**
 * éŸ³ä¹æŸ¥è¯¢è¯·æ±‚DTO
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Data
public class MusicQueryDTO {
    /**
     * é¡µç 
     */
    private Integer pageNum = 1;

    /**
     * æ¯é¡µå¤§å°
     */
    private Integer pageSize = 10;

    /**
     * åˆ†ç±»ID
     */
    private Long categoryId;

    /**
     * å…³é”®è¯ï¼ˆæ­Œæ›²å/æ­Œæ‰‹åï¼‰
     */
    private String keyword;

    /**
     * æ’åºå­—æ®µ(play_count/create_time)
     */
    private String sortField = "create_time";

    /**
     * æ’åºæ–¹å¼(asc/desc)
     */
    private String sortOrder = "desc";
}
```

#### 5.2.3 æ’­æ”¾è®°å½•è¯·æ±‚ DTO

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/model/dto/PlayRecordDTO.java`

```java
package com.naruto.wangyiyunmusic.model.dto;

import lombok.Data;
import javax.validation.constraints.NotNull;

/**
 * æ’­æ”¾è®°å½•è¯·æ±‚DTO
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@Data
public class PlayRecordDTO {
    /**
     * éŸ³ä¹ID
     */
    @NotNull(message = "éŸ³ä¹IDä¸èƒ½ä¸ºç©º")
    private Long musicId;

    /**
     * æ’­æ”¾æ—¶é•¿(ç§’)
     */
    private Integer playDuration;

    /**
     * æ’­æ”¾æ¥æº
     */
    private String playSource = "web";
}
```

### 5.3 Service ä¸šåŠ¡é€»è¾‘

#### 5.3.1 MusicService æ‰©å±•

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/service/MusicService.java` (æ‰‹åŠ¨æ·»åŠ æ–¹æ³•)

```java
// åœ¨è‡ªåŠ¨ç”Ÿæˆçš„ MusicService æ¥å£ä¸­æ·»åŠ ä»¥ä¸‹æ–¹æ³•

/**
 * åˆ†é¡µæŸ¥è¯¢éŸ³ä¹åˆ—è¡¨
 *
 * @param queryDTO æŸ¥è¯¢æ¡ä»¶
 * @return åˆ†é¡µç»“æœ
 */
IPage<Music> pageQuery(MusicQueryDTO queryDTO);

/**
 * è·å–éŸ³ä¹è¯¦æƒ…ï¼ˆåŒ…å«æ­Œæ‰‹ã€ä¸“è¾‘ã€æ ‡ç­¾ç­‰ï¼‰
 *
 * @param id éŸ³ä¹ID
 * @return éŸ³ä¹è¯¦æƒ…
 */
MusicDetailVO getMusicDetail(Long id);
```

#### 5.3.2 MusicServiceImpl å®ç°

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/service/impl/MusicServiceImpl.java` (æ‰‹åŠ¨æ·»åŠ å®ç°)

```java
// åœ¨è‡ªåŠ¨ç”Ÿæˆçš„ MusicServiceImpl ç±»ä¸­æ·»åŠ ä»¥ä¸‹å®ç°

@Autowired
private ArtistService artistService;

@Autowired
private MusicArtistService musicArtistService;

@Autowired
private AlbumService albumService;

@Autowired
private CategoryService categoryService;

@Autowired
private TagService tagService;

@Autowired
private MusicTagService musicTagService;

@Override
public IPage<Music> pageQuery(MusicQueryDTO queryDTO) {
    // æ„å»ºåˆ†é¡µå¯¹è±¡
    Page<Music> page = new Page<>(queryDTO.getPageNum(), queryDTO.getPageSize());

    // æ„å»ºæŸ¥è¯¢æ¡ä»¶
    LambdaQueryWrapper<Music> wrapper = new LambdaQueryWrapper<>();

    // åˆ†ç±»ç­›é€‰
    if (queryDTO.getCategoryId() != null) {
        wrapper.eq(Music::getCategoryId, queryDTO.getCategoryId());
    }

    // å…³é”®è¯æœç´¢ï¼ˆæ­Œæ›²åï¼‰
    if (StringUtils.hasText(queryDTO.getKeyword())) {
        wrapper.like(Music::getTitle, queryDTO.getKeyword());
    }

    // æ’åº
    if ("play_count".equals(queryDTO.getSortField())) {
        wrapper.orderBy(true, "asc".equals(queryDTO.getSortOrder()), Music::getPlayCount);
    } else {
        wrapper.orderBy(true, "asc".equals(queryDTO.getSortOrder()), Music::getCreateTime);
    }

    return this.page(page, wrapper);
}

@Override
public MusicDetailVO getMusicDetail(Long id) {
    // æŸ¥è¯¢éŸ³ä¹åŸºæœ¬ä¿¡æ¯
    Music music = this.getById(id);
    if (music == null) {
        throw new BusinessException("éŸ³ä¹ä¸å­˜åœ¨");
    }

    MusicDetailVO vo = new MusicDetailVO();
    BeanUtils.copyProperties(music, vo);

    // æŸ¥è¯¢ä¸“è¾‘åç§°
    if (music.getAlbumId() != null) {
        Album album = albumService.getById(music.getAlbumId());
        if (album != null) {
            vo.setAlbumName(album.getName());
        }
    }

    // æŸ¥è¯¢åˆ†ç±»åç§°
    if (music.getCategoryId() != null) {
        Category category = categoryService.getById(music.getCategoryId());
        if (category != null) {
            vo.setCategoryName(category.getName());
        }
    }

    // æŸ¥è¯¢æ­Œæ‰‹åˆ—è¡¨
    List<MusicArtist> musicArtists = musicArtistService.list(
        new LambdaQueryWrapper<MusicArtist>().eq(MusicArtist::getMusicId, id)
    );
    List<ArtistVO> artistVOList = musicArtists.stream().map(ma -> {
        Artist artist = artistService.getById(ma.getArtistId());
        ArtistVO artistVO = new ArtistVO();
        artistVO.setId(artist.getId());
        artistVO.setName(artist.getName());
        artistVO.setRole(ma.getArtistRole());
        return artistVO;
    }).collect(Collectors.toList());
    vo.setArtists(artistVOList);

    // æŸ¥è¯¢æ ‡ç­¾åˆ—è¡¨
    List<MusicTag> musicTags = musicTagService.list(
        new LambdaQueryWrapper<MusicTag>().eq(MusicTag::getMusicId, id)
    );
    List<String> tagNames = musicTags.stream().map(mt -> {
        Tag tag = tagService.getById(mt.getTagId());
        return tag != null ? tag.getName() : null;
    }).filter(Objects::nonNull).collect(Collectors.toList());
    vo.setTags(tagNames);

    return vo;
}
```

#### 5.3.3 PlayRecordService æ‰©å±•

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/service/PlayRecordService.java` (æ·»åŠ æ–¹æ³•)

```java
/**
 * è®°å½•æ’­æ”¾
 *
 * @param recordDTO æ’­æ”¾è®°å½•DTO
 */
void recordPlay(PlayRecordDTO recordDTO);

/**
 * æŸ¥è¯¢æ’­æ”¾å†å²
 *
 * @param userId ç”¨æˆ·ID
 * @param pageNum é¡µç 
 * @param pageSize æ¯é¡µå¤§å°
 * @return æ’­æ”¾è®°å½•åˆ—è¡¨
 */
IPage<PlayRecord> getPlayHistory(Long userId, Integer pageNum, Integer pageSize);
```

**å®ç°**:

```java
@Override
@Transactional
public void recordPlay(PlayRecordDTO recordDTO) {
    // æ’å…¥æ’­æ”¾è®°å½•
    PlayRecord record = new PlayRecord();
    record.setMusicId(recordDTO.getMusicId());
    record.setUserId(0L); // æš‚æ—¶é»˜è®¤0
    record.setPlayDuration(recordDTO.getPlayDuration());
    record.setPlaySource(recordDTO.getPlaySource());
    this.save(record);

    // æ›´æ–°éŸ³ä¹æ’­æ”¾æ¬¡æ•°
    Music music = musicService.getById(recordDTO.getMusicId());
    if (music != null) {
        music.setPlayCount(music.getPlayCount() + 1);
        musicService.updateById(music);
    }
}

@Override
public IPage<PlayRecord> getPlayHistory(Long userId, Integer pageNum, Integer pageSize) {
    Page<PlayRecord> page = new Page<>(pageNum, pageSize);
    LambdaQueryWrapper<PlayRecord> wrapper = new LambdaQueryWrapper<>();
    wrapper.eq(PlayRecord::getUserId, userId)
           .orderByDesc(PlayRecord::getCreateTime);
    return this.page(page, wrapper);
}
```

#### 5.3.4 FavoriteService æ‰©å±•

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/service/FavoriteService.java` (æ·»åŠ æ–¹æ³•)

```java
/**
 * æ”¶è—éŸ³ä¹
 *
 * @param musicId éŸ³ä¹ID
 */
void addFavorite(Long musicId);

/**
 * å–æ¶ˆæ”¶è—
 *
 * @param musicId éŸ³ä¹ID
 */
void removeFavorite(Long musicId);

/**
 * æŸ¥è¯¢æ”¶è—åˆ—è¡¨
 *
 * @param userId ç”¨æˆ·ID
 * @param pageNum é¡µç 
 * @param pageSize æ¯é¡µå¤§å°
 * @return æ”¶è—åˆ—è¡¨
 */
IPage<Favorite> getFavoriteList(Long userId, Integer pageNum, Integer pageSize);
```

**å®ç°**:

```java
@Override
@Transactional
public void addFavorite(Long musicId) {
    Long userId = 0L; // æš‚æ—¶é»˜è®¤0

    // æ£€æŸ¥æ˜¯å¦å·²æ”¶è—
    Favorite existing = this.getOne(
        new LambdaQueryWrapper<Favorite>()
            .eq(Favorite::getUserId, userId)
            .eq(Favorite::getMusicId, musicId)
    );

    if (existing != null && existing.getIsDeleted() == 0) {
        throw new BusinessException("å·²æ”¶è—è¯¥éŸ³ä¹");
    }

    if (existing != null) {
        // æ¢å¤æ”¶è—
        existing.setIsDeleted(0);
        this.updateById(existing);
    } else {
        // æ–°å¢æ”¶è—
        Favorite favorite = new Favorite();
        favorite.setUserId(userId);
        favorite.setMusicId(musicId);
        this.save(favorite);
    }

    // æ›´æ–°éŸ³ä¹æ”¶è—æ¬¡æ•°
    Music music = musicService.getById(musicId);
    if (music != null) {
        music.setFavoriteCount(music.getFavoriteCount() + 1);
        musicService.updateById(music);
    }
}

@Override
@Transactional
public void removeFavorite(Long musicId) {
    Long userId = 0L; // æš‚æ—¶é»˜è®¤0

    Favorite favorite = this.getOne(
        new LambdaQueryWrapper<Favorite>()
            .eq(Favorite::getUserId, userId)
            .eq(Favorite::getMusicId, musicId)
    );

    if (favorite == null || favorite.getIsDeleted() == 1) {
        throw new BusinessException("æœªæ”¶è—è¯¥éŸ³ä¹");
    }

    // é€»è¾‘åˆ é™¤
    favorite.setIsDeleted(1);
    this.updateById(favorite);

    // æ›´æ–°éŸ³ä¹æ”¶è—æ¬¡æ•°
    Music music = musicService.getById(musicId);
    if (music != null && music.getFavoriteCount() > 0) {
        music.setFavoriteCount(music.getFavoriteCount() - 1);
        musicService.updateById(music);
    }
}

@Override
public IPage<Favorite> getFavoriteList(Long userId, Integer pageNum, Integer pageSize) {
    Page<Favorite> page = new Page<>(pageNum, pageSize);
    LambdaQueryWrapper<Favorite> wrapper = new LambdaQueryWrapper<>();
    wrapper.eq(Favorite::getUserId, userId)
           .eq(Favorite::getIsDeleted, 0)
           .orderByDesc(Favorite::getCreateTime);
    return this.page(page, wrapper);
}
```

### 5.4 Controller æ¥å£

#### 5.4.1 MusicController å®Œå–„

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/controller/MusicController.java` (æ›¿æ¢è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç )

```java
package com.naruto.wangyiyunmusic.controller;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.naruto.wangyiyunmusic.common.Result;
import com.naruto.wangyiyunmusic.model.dto.MusicQueryDTO;
import com.naruto.wangyiyunmusic.model.entity.Music;
import com.naruto.wangyiyunmusic.model.vo.MusicDetailVO;
import com.naruto.wangyiyunmusic.service.MusicService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

/**
 * éŸ³ä¹æ§åˆ¶å™¨
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@RestController
@RequestMapping("/api/music")
public class MusicController {

    @Autowired
    private MusicService musicService;

    /**
     * åˆ†é¡µæŸ¥è¯¢éŸ³ä¹åˆ—è¡¨
     *
     * @param queryDTO æŸ¥è¯¢æ¡ä»¶
     * @return åˆ†é¡µç»“æœ
     */
    @GetMapping("/list")
    public Result<IPage<Music>> list(MusicQueryDTO queryDTO) {
        IPage<Music> page = musicService.pageQuery(queryDTO);
        return Result.success(page);
    }

    /**
     * è·å–éŸ³ä¹è¯¦æƒ…
     *
     * @param id éŸ³ä¹ID
     * @return éŸ³ä¹è¯¦æƒ…
     */
    @GetMapping("/{id}")
    public Result<MusicDetailVO> getDetail(@PathVariable Long id) {
        MusicDetailVO detail = musicService.getMusicDetail(id);
        return Result.success(detail);
    }
}
```

#### 5.4.2 PlayRecordController

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/controller/PlayRecordController.java` (æ›¿æ¢è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç )

```java
package com.naruto.wangyiyunmusic.controller;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.naruto.wangyiyunmusic.common.Result;
import com.naruto.wangyiyunmusic.model.dto.PlayRecordDTO;
import com.naruto.wangyiyunmusic.model.entity.PlayRecord;
import com.naruto.wangyiyunmusic.service.PlayRecordService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.validation.annotation.Validated;
import org.springframework.web.bind.annotation.*;

/**
 * æ’­æ”¾è®°å½•æ§åˆ¶å™¨
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@RestController
@RequestMapping("/api/play-record")
public class PlayRecordController {

    @Autowired
    private PlayRecordService playRecordService;

    /**
     * è®°å½•æ’­æ”¾
     *
     * @param recordDTO æ’­æ”¾è®°å½•DTO
     * @return æˆåŠŸå“åº”
     */
    @PostMapping
    public Result<Void> recordPlay(@RequestBody @Validated PlayRecordDTO recordDTO) {
        playRecordService.recordPlay(recordDTO);
        return Result.success();
    }

    /**
     * æŸ¥è¯¢æ’­æ”¾å†å²
     *
     * @param pageNum é¡µç 
     * @param pageSize æ¯é¡µå¤§å°
     * @return æ’­æ”¾è®°å½•åˆ—è¡¨
     */
    @GetMapping("/history")
    public Result<IPage<PlayRecord>> getHistory(
        @RequestParam(defaultValue = "1") Integer pageNum,
        @RequestParam(defaultValue = "10") Integer pageSize
    ) {
        IPage<PlayRecord> page = playRecordService.getPlayHistory(0L, pageNum, pageSize);
        return Result.success(page);
    }
}
```

#### 5.4.3 FavoriteController

**æ–‡ä»¶**: `src/main/java/com/naruto/wangyiyunmusic/controller/FavoriteController.java` (æ›¿æ¢è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç )

```java
package com.naruto.wangyiyunmusic.controller;

import com.baomidou.mybatisplus.core.metadata.IPage;
import com.naruto.wangyiyunmusic.common.Result;
import com.naruto.wangyiyunmusic.model.entity.Favorite;
import com.naruto.wangyiyunmusic.service.FavoriteService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.*;

/**
 * æ”¶è—æ§åˆ¶å™¨
 *
 * @Author: naruto
 * @CreateTime: 2026-01-24
 */
@RestController
@RequestMapping("/api/favorite")
public class FavoriteController {

    @Autowired
    private FavoriteService favoriteService;

    /**
     * æ”¶è—éŸ³ä¹
     *
     * @param musicId éŸ³ä¹ID
     * @return æˆåŠŸå“åº”
     */
    @PostMapping("/{musicId}")
    public Result<Void> addFavorite(@PathVariable Long musicId) {
        favoriteService.addFavorite(musicId);
        return Result.success();
    }

    /**
     * å–æ¶ˆæ”¶è—
     *
     * @param musicId éŸ³ä¹ID
     * @return æˆåŠŸå“åº”
     */
    @DeleteMapping("/{musicId}")
    public Result<Void> removeFavorite(@PathVariable Long musicId) {
        favoriteService.removeFavorite(musicId);
        return Result.success();
    }

    /**
     * æŸ¥è¯¢æ”¶è—åˆ—è¡¨
     *
     * @param pageNum é¡µç 
     * @param pageSize æ¯é¡µå¤§å°
     * @return æ”¶è—åˆ—è¡¨
     */
    @GetMapping("/list")
    public Result<IPage<Favorite>> getFavoriteList(
        @RequestParam(defaultValue = "1") Integer pageNum,
        @RequestParam(defaultValue = "10") Integer pageSize
    ) {
        IPage<Favorite> page = favoriteService.getFavoriteList(0L, pageNum, pageSize);
        return Result.success(page);
    }
}
```

---

## é˜¶æ®µ 6ï¼šæ¥å£æµ‹è¯•

### 6.1 æµ‹è¯•å‡†å¤‡

1. **åˆ›å»ºæ•°æ®åº“**: `wangyiyun_music`
2. **æ‰§è¡Œ SQL è„šæœ¬**:
   - `docs/sql/music.sql` (å»ºè¡¨)
   - `docs/sql/test_data.sql` (æµ‹è¯•æ•°æ®)
3. **å¯åŠ¨åº”ç”¨**: è¿è¡Œ `WangyiyunMusicApplication.main()`

### 6.2 æ¥å£æµ‹è¯•ç”¨ä¾‹

#### æµ‹è¯• 1: è·å–éŸ³ä¹åˆ—è¡¨
```bash
curl -X GET "http://localhost:8910/api/music/list?pageNum=1&pageSize=10&sortField=play_count&sortOrder=desc"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "records": [...],
    "total": 3,
    "size": 10,
    "current": 1
  }
}
```

#### æµ‹è¯• 2: è·å–éŸ³ä¹è¯¦æƒ…
```bash
curl -X GET "http://localhost:8910/api/music/1"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æ™´å¤©",
    "albumName": "å¶æƒ ç¾",
    "artists": [{"id": 1, "name": "å‘¨æ°ä¼¦", "role": "singer"}],
    "tags": []
  }
}
```

#### æµ‹è¯• 3: è®°å½•æ’­æ”¾
```bash
curl -X POST "http://localhost:8910/api/play-record" \
  -H "Content-Type: application/json" \
  -d '{"musicId": 1, "playDuration": 180, "playSource": "web"}'
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

#### æµ‹è¯• 4: æ”¶è—éŸ³ä¹
```bash
curl -X POST "http://localhost:8910/api/favorite/1"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

#### æµ‹è¯• 5: æŸ¥è¯¢æ”¶è—åˆ—è¡¨
```bash
curl -X GET "http://localhost:8910/api/favorite/list?pageNum=1&pageSize=10"
```

#### æµ‹è¯• 6: å–æ¶ˆæ”¶è—
```bash
curl -X DELETE "http://localhost:8910/api/favorite/1"
```

### 6.3 éªŒè¯æ¸…å•

- [ ] æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸï¼ˆ9 å¼ è¡¨ï¼‰
- [ ] æµ‹è¯•æ•°æ®æ’å…¥æˆåŠŸ
- [ ] MyBatis-Plus ä»£ç ç”ŸæˆæˆåŠŸ
- [ ] åº”ç”¨å¯åŠ¨æ— æŠ¥é”™
- [ ] éŸ³ä¹åˆ—è¡¨æ¥å£æ­£å¸¸
- [ ] éŸ³ä¹è¯¦æƒ…æ¥å£æ­£å¸¸ï¼ˆåŒ…å«æ­Œæ‰‹ã€ä¸“è¾‘ã€æ ‡ç­¾ï¼‰
- [ ] æ’­æ”¾è®°å½•æ¥å£æ­£å¸¸ï¼ˆæ’­æ”¾æ¬¡æ•°+1ï¼‰
- [ ] æ”¶è—æ¥å£æ­£å¸¸ï¼ˆæ”¶è—æ¬¡æ•°+1ï¼‰
- [ ] å–æ¶ˆæ”¶è—æ¥å£æ­£å¸¸ï¼ˆæ”¶è—æ¬¡æ•°-1ï¼‰
- [ ] åˆ†é¡µåŠŸèƒ½æ­£å¸¸
- [ ] å‚æ•°æ ¡éªŒæ­£å¸¸
- [ ] å¼‚å¸¸å¤„ç†æ­£å¸¸

---

## ğŸ“Š é¡¹ç›®æ–‡ä»¶ç»“æ„ï¼ˆæœ€ç»ˆï¼‰

```
wangyiyun-music/
â”œâ”€â”€ docs/
â”‚   â””â”€â”€ sql/
â”‚       â”œâ”€â”€ music.sql              # å»ºè¡¨è„šæœ¬
â”‚       â””â”€â”€ test_data.sql          # æµ‹è¯•æ•°æ®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/naruto/wangyiyunmusic/
â”‚   â”‚   â”‚   â”œâ”€â”€ WangyiyunMusicApplication.java
â”‚   â”‚   â”‚   â”œâ”€â”€ common/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Result.java         # ç»Ÿä¸€å“åº”
â”‚   â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ MybatisPlusConfig.java
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MusicController.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PlayRecordController.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FavoriteController.java
â”‚   â”‚   â”‚   â”œâ”€â”€ exception/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ BusinessException.java
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MusicMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ArtistMapper.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ... (å…±9ä¸ªMapper)
â”‚   â”‚   â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ dto/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ MusicQueryDTO.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ PlayRecordDTO.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Music.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Artist.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ... (å…±9ä¸ªEntity)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ vo/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ MusicDetailVO.java
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ArtistVO.java
â”‚   â”‚   â”‚   â””â”€â”€ service/
â”‚   â”‚   â”‚       â”œâ”€â”€ MusicService.java
â”‚   â”‚   â”‚       â”œâ”€â”€ PlayRecordService.java
â”‚   â”‚   â”‚       â”œâ”€â”€ FavoriteService.java
â”‚   â”‚   â”‚       â””â”€â”€ impl/ (å…±9ä¸ªServiceImpl)
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â”œâ”€â”€ application.yaml
â”‚   â”‚       â””â”€â”€ mapper/
â”‚   â”‚           â””â”€â”€ ... (å…±9ä¸ªXML)
â”‚   â””â”€â”€ test/
â”‚       â””â”€â”€ java/com/naruto/wangyiyunmusic/
â”‚           â””â”€â”€ CodeGenerator.java      # ä»£ç ç”Ÿæˆå™¨
â”œâ”€â”€ pom.xml
â””â”€â”€ CLAUDE.md
```

---

## ğŸ¯ å…³é”®æŠ€æœ¯ç‚¹

1. **MyBatis-Plus ä»£ç ç”Ÿæˆå™¨**: ä¸€é”®ç”Ÿæˆ Entity/Mapper/Service/Controller
2. **é€»è¾‘åˆ é™¤**: ä½¿ç”¨ `is_deleted` å­—æ®µå®ç°è½¯åˆ é™¤
3. **åˆ†é¡µæŸ¥è¯¢**: MyBatis-Plus å†…ç½®åˆ†é¡µæ’ä»¶
4. **æ¡ä»¶æ„é€ å™¨**: LambdaQueryWrapper å®ç°åŠ¨æ€æŸ¥è¯¢
5. **ç»Ÿä¸€å“åº”**: Result å°è£…ç»Ÿä¸€è¿”å›æ ¼å¼
6. **å…¨å±€å¼‚å¸¸å¤„ç†**: @RestControllerAdvice ç»Ÿä¸€æ•è·å¼‚å¸¸
7. **å‚æ•°æ ¡éªŒ**: @Validated + Hibernate Validator
8. **äº‹åŠ¡ç®¡ç†**: @Transactional ä¿è¯æ•°æ®ä¸€è‡´æ€§
9. **å…³è”æŸ¥è¯¢**: æ‰‹åŠ¨æŸ¥è¯¢å…³è”è¡¨å¹¶ç»„è£… VO
10. **æ•°æ®åº“è®¾è®¡**: å®Œæ•´çš„å¤šå¯¹å¤šå…³ç³»å»ºæ¨¡

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **æ•°æ®åº“è¿æ¥**: ç¡®ä¿ MySQL å·²å¯åŠ¨ï¼Œæ•°æ®åº“ `wangyiyun_music` å·²åˆ›å»º
2. **ä»£ç ç”Ÿæˆ**: ç”Ÿæˆåçš„ä»£ç éœ€è¦æ‰‹åŠ¨æ·»åŠ ä¸šåŠ¡é€»è¾‘
3. **ç”¨æˆ·è®¤è¯**: å½“å‰ `user_id` é»˜è®¤ä¸º 0ï¼Œåç»­éœ€é›†æˆç”¨æˆ·ç³»ç»Ÿ
4. **æ–‡ä»¶ URL**: `file_url` å’Œ `cover_url` åç»­éœ€é›†æˆæ–‡ä»¶ä¸Šä¼ æœåŠ¡
5. **æ€§èƒ½ä¼˜åŒ–**: éŸ³ä¹è¯¦æƒ…æŸ¥è¯¢æ¶‰åŠå¤šè¡¨å…³è”ï¼Œåç»­å¯ä¼˜åŒ–ä¸º SQL JOIN æˆ–ç¼“å­˜

---

**è®¡åˆ’å®Œæˆï¼ç­‰å¾…ç”¨æˆ·æ‰¹å‡†åè¿›å…¥æ‰§è¡Œé˜¶æ®µã€‚**
