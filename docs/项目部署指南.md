# é¡¹ç›®éƒ¨ç½²æŒ‡å—

> ğŸ“¦ æ¨èä½¿ç”¨ä¸€ä½“åŒ–éƒ¨ç½²æ–¹æ¡ˆï¼Œæ‰€æœ‰æ–‡ä»¶åœ¨ä¸€ä¸ªç›®å½•ï¼Œç®€å•é«˜æ•ˆ

---

## ğŸ¯ éƒ¨ç½²æ–¹æ¡ˆæ¦‚è§ˆ

### æ¨èæ–¹æ¡ˆï¼šä¸€ä½“åŒ–éƒ¨ç½² â­

**æ ¸å¿ƒç†å¿µ**ï¼šå°†åº”ç”¨ã€æ•°æ®ã€å·¥å…·ç»Ÿä¸€æ”¾åœ¨ä¸€ä¸ªç›®å½•ä¸‹ï¼Œæ— éœ€é…ç½®ç¯å¢ƒå˜é‡ã€‚

```
/opt/service/wangyiyun-music/          â† éƒ¨ç½²æ ¹ç›®å½•
â”œâ”€â”€ wangyiyun-music-0.0.1-SNAPSHOT.jar â† åº”ç”¨ç¨‹åº
â”œâ”€â”€ music-data/                         â† æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ temp/                          â† ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
â”‚   â””â”€â”€ audio/                         â† æ°¸ä¹…éŸ³é¢‘æ–‡ä»¶
â”œâ”€â”€ tools/                              â† å·¥å…·ç›®å½•
â”‚   â””â”€â”€ yt-dlp                         â† è§†é¢‘è§£æå·¥å…·
â””â”€â”€ logs/                               â† æ—¥å¿—ç›®å½•
    â””â”€â”€ application.log
```

**ä¼˜åŠ¿**ï¼š
- âœ… **é›¶é…ç½®**ï¼šæ— éœ€è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œåˆ›å»ºç›®å½•å³å¯
- âœ… **æ˜“ç†è§£**ï¼šæ‰€æœ‰æ–‡ä»¶åœ¨ä¸€èµ·ï¼Œä¸€ç›®äº†ç„¶
- âœ… **æ˜“è¿ç§»**ï¼šæ•´ä½“æ‰“åŒ…å³å¯è¿ç§»åˆ°å…¶ä»–æœåŠ¡å™¨
- âœ… **æ˜“å¤‡ä»½**ï¼šä¸€ä¸ªå‘½ä»¤å¤‡ä»½æ‰€æœ‰æ•°æ®

---

## ğŸš€ å¿«é€Ÿå¼€å§‹ï¼ˆ5åˆ†é’Ÿï¼‰

### æ–¹å¼ 1ï¼šè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨
scp scripts/deploy-simple.sh user@server:/tmp/

# 2. æ‰§è¡Œä¸€é”®éƒ¨ç½²
ssh user@server
sudo bash /tmp/deploy-simple.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆ**ï¼š
- âœ… åˆ›å»ºç›®å½•ç»“æ„
- âœ… éƒ¨ç½²åº”ç”¨ JAR
- âœ… å®‰è£… yt-dlp å·¥å…·
- âœ… é…ç½® systemd æœåŠ¡
- âœ… è®¾ç½®æ–‡ä»¶æƒé™
- âœ… å¯åŠ¨æœåŠ¡å¹¶éªŒè¯

**å®Œæˆåè®¿é—®**ï¼š
- Swagger UI: http://æœåŠ¡å™¨IP:8910/swagger-ui/index.html
- API æ–‡æ¡£: http://æœåŠ¡å™¨IP:8910/v3/api-docs

---

### æ–¹å¼ 2ï¼šæ‰‹åŠ¨éƒ¨ç½²ï¼ˆ3æ­¥å®Œæˆï¼‰

#### æ­¥éª¤ 1ï¼šåˆ›å»ºç›®å½•ç»“æ„

```bash
# åˆ›å»ºéƒ¨ç½²æ ¹ç›®å½•ï¼ˆè·¯å¾„å¯è‡ªå®šä¹‰ï¼‰
sudo mkdir -p /opt/service/wangyiyun-music

# åˆ‡æ¢åˆ°éƒ¨ç½²ç›®å½•
cd /opt/service/wangyiyun-music

# åˆ›å»ºå­ç›®å½•
sudo mkdir -p music-data/temp      # ä¸´æ—¶éŸ³é¢‘æ–‡ä»¶
sudo mkdir -p music-data/audio     # æ°¸ä¹…éŸ³é¢‘æ–‡ä»¶
sudo mkdir -p tools                 # å·¥å…·ç›®å½•
sudo mkdir -p logs                  # æ—¥å¿—ç›®å½•
```

#### æ­¥éª¤ 2ï¼šéƒ¨ç½²æ–‡ä»¶

```bash
# 2.1 å¤åˆ¶åº”ç”¨ JAR åŒ…
sudo cp /path/to/wangyiyun-music-0.0.1-SNAPSHOT.jar /opt/service/wangyiyun-music/

# 2.2 ä¸‹è½½ yt-dlp å·¥å…·
sudo wget https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp \
  -O /opt/service/wangyiyun-music/tools/yt-dlp

# 2.3 è®¾ç½®æ‰§è¡Œæƒé™
sudo chmod +x /opt/service/wangyiyun-music/tools/yt-dlp

# 2.4 éªŒè¯å·¥å…·å®‰è£…
/opt/service/wangyiyun-music/tools/yt-dlp --version
```

#### æ­¥éª¤ 3ï¼šå¯åŠ¨åº”ç”¨

**å‰ææ¡ä»¶**ï¼šåˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆæ¨èï¼Œå®‰å…¨æœ€ä½³å®è·µï¼‰

```bash
# åˆ›å»ºåº”ç”¨ç”¨æˆ·ï¼ˆä¸å…è®¸ç™»å½•ï¼‰
sudo useradd -r -s /bin/false appuser

# è®¾ç½®ç›®å½•æ‰€æœ‰æƒ
sudo chown -R appuser:appuser /opt/service/wangyiyun-music
```

---

**æ–¹å¼ Aï¼šç›´æ¥å¯åŠ¨ï¼ˆæµ‹è¯•ç¯å¢ƒï¼‰**

```bash
cd /opt/service/wangyiyun-music

# å‰å°è¿è¡Œï¼ˆæŸ¥çœ‹æ—¥å¿—ï¼‰
java -jar wangyiyun-music-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=prod

# åå°è¿è¡Œ
nohup java -jar wangyiyun-music-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=prod > logs/app.log 2>&1 &
```

---

**æ–¹å¼ Bï¼šsystemd æœåŠ¡ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰**

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/wangyiyun-music.service`ï¼š

```ini
[Unit]
Description=WangYiYun Music Service
After=network.target mysql.service

[Service]
Type=simple
User=appuser
WorkingDirectory=/opt/service/wangyiyun-music

# JVM å‚æ•°é…ç½®
Environment="JAVA_OPTS=-Xms512m -Xmx2g -XX:+UseG1GC"

# å¯åŠ¨å‘½ä»¤
ExecStart=/usr/bin/java $JAVA_OPTS \
  -jar /opt/service/wangyiyun-music/wangyiyun-music-0.0.1-SNAPSHOT.jar \
  --spring.profiles.active=prod

# é‡å¯ç­–ç•¥
Restart=on-failure
RestartSec=10

# æ—¥å¿—é…ç½®
StandardOutput=journal
StandardError=journal
SyslogIdentifier=wangyiyun-music

[Install]
WantedBy=multi-user.target
```

**å¯åŠ¨æœåŠ¡**ï¼š

```bash
# é‡è½½ systemd é…ç½®
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start wangyiyun-music

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status wangyiyun-music

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable wangyiyun-music

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u wangyiyun-music -f
```

---

## âœ… éƒ¨ç½²éªŒè¯

### 1. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
sudo systemctl status wangyiyun-music

# æŸ¥çœ‹ç«¯å£ç›‘å¬
netstat -tuln | grep 8910
# æˆ–
ss -tuln | grep 8910
```

### 2. éªŒè¯ API è®¿é—®

```bash
# æ–¹å¼ 1ï¼šæ£€æŸ¥ Swagger UI
curl -I http://localhost:8910/swagger-ui/index.html

# æ–¹å¼ 2ï¼šæµ‹è¯• API æ¥å£
curl http://localhost:8910/api/music/list

# æ–¹å¼ 3ï¼šæµè§ˆå™¨è®¿é—®
# http://æœåŠ¡å™¨IP:8910/swagger-ui/index.html
```

### 3. éªŒè¯ç›®å½•ç»“æ„

```bash
# æŸ¥çœ‹ç›®å½•ç»“æ„
tree -L 2 /opt/service/wangyiyun-music

# é¢„æœŸè¾“å‡ºï¼š
# /opt/service/wangyiyun-music/
# â”œâ”€â”€ wangyiyun-music-0.0.1-SNAPSHOT.jar
# â”œâ”€â”€ music-data/
# â”‚   â”œâ”€â”€ temp/
# â”‚   â””â”€â”€ audio/
# â”œâ”€â”€ tools/
# â”‚   â””â”€â”€ yt-dlp
# â””â”€â”€ logs/
```

### 4. éªŒè¯æ—¥å¿—è¾“å‡º

```bash
# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
tail -f /opt/service/wangyiyun-music/logs/application.log

# æŸ¥çœ‹ systemd æ—¥å¿—
sudo journalctl -u wangyiyun-music -n 50
```

---

## ğŸ”§ é…ç½®è¯´æ˜

### è‡ªåŠ¨è·¯å¾„è§£æ

åº”ç”¨ä¼š**è‡ªåŠ¨è¯†åˆ«**ç›¸å¯¹äºéƒ¨ç½²ç›®å½•çš„è·¯å¾„ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®ï¼š

| é…ç½®é¡¹ | è‡ªåŠ¨è§£æå€¼ | å®é™…è·¯å¾„ç¤ºä¾‹ |
|--------|-----------|-------------|
| éŸ³é¢‘æ–‡ä»¶å­˜å‚¨ | `${user.dir}/music-data/audio/` | `/opt/service/wangyiyun-music/music-data/audio/` |
| ä¸´æ—¶æ–‡ä»¶å­˜å‚¨ | `${user.dir}/music-data/temp/` | `/opt/service/wangyiyun-music/music-data/temp/` |
| yt-dlp å·¥å…· | `${user.dir}/tools/yt-dlp` | `/opt/service/wangyiyun-music/tools/yt-dlp` |

**å…³é”®**ï¼š
- âœ… `${user.dir}` æ˜¯ Java çš„å·¥ä½œç›®å½•ï¼ˆé€šå¸¸æ˜¯ JAR åŒ…æ‰€åœ¨ç›®å½•ï¼‰
- âœ… systemd æœåŠ¡ä¸­ä½¿ç”¨ `WorkingDirectory` æŒ‡å®šå·¥ä½œç›®å½•
- âœ… æ‰‹åŠ¨å¯åŠ¨æ—¶ç¡®ä¿å…ˆ `cd` åˆ°éƒ¨ç½²ç›®å½•

### éƒ¨ç½²ç›®å½•è‡ªå®šä¹‰

å¯ä»¥éƒ¨ç½²åœ¨**ä»»æ„ä½ç½®**ï¼Œåªéœ€ç¡®ä¿ç›®å½•ç»“æ„ä¸€è‡´ï¼š

```bash
# ç¤ºä¾‹ 1ï¼š/opt/service/
/opt/service/wangyiyun-music/

# ç¤ºä¾‹ 2ï¼š/home/user/
/home/user/wangyiyun-music/

# ç¤ºä¾‹ 3ï¼š/usr/local/
/usr/local/wangyiyun-music/
```

**è¦ç‚¹**ï¼šå¯åŠ¨æ—¶ç¡®ä¿å·¥ä½œç›®å½•æ­£ç¡®

```bash
# systemd æœåŠ¡
WorkingDirectory=/your/custom/path/

# æ‰‹åŠ¨å¯åŠ¨
cd /your/custom/path/
java -jar wangyiyun-music.jar
```

---

## ğŸ“Š è¿ç»´ç®¡ç†

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start wangyiyun-music

# åœæ­¢æœåŠ¡
sudo systemctl stop wangyiyun-music

# é‡å¯æœåŠ¡
sudo systemctl restart wangyiyun-music

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status wangyiyun-music

# å¼€æœºè‡ªå¯
sudo systemctl enable wangyiyun-music

# ç¦ç”¨è‡ªå¯
sudo systemctl disable wangyiyun-music
```

### æ—¥å¿—ç®¡ç†

```bash
# æŸ¥çœ‹å®æ—¶æ—¥å¿—
sudo journalctl -u wangyiyun-music -f

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œæ—¥å¿—
sudo journalctl -u wangyiyun-music -n 100

# æŸ¥çœ‹ä»Šå¤©çš„æ—¥å¿—
sudo journalctl -u wangyiyun-music --since today

# æŸ¥çœ‹æŒ‡å®šæ—¶é—´æ®µæ—¥å¿—
sudo journalctl -u wangyiyun-music --since "2026-01-31 10:00:00" --until "2026-01-31 12:00:00"
```

### å¤‡ä»½ä¸æ¢å¤

**å¤‡ä»½**ï¼ˆè¶…ç®€å•ï¼‰ï¼š

```bash
# æ–¹å¼ 1ï¼šæ•´ä½“å¤‡ä»½
tar -czf wangyiyun-music-backup-$(date +%Y%m%d).tar.gz \
  /opt/service/wangyiyun-music

# æ–¹å¼ 2ï¼šä»…å¤‡ä»½æ•°æ®
tar -czf music-data-backup-$(date +%Y%m%d).tar.gz \
  /opt/service/wangyiyun-music/music-data

# æ–¹å¼ 3ï¼šå¢é‡å¤‡ä»½ï¼ˆrsyncï¼‰
rsync -avz --delete \
  /opt/service/wangyiyun-music/ \
  /backup/wangyiyun-music-$(date +%Y%m%d)/
```

**æ¢å¤**ï¼š

```bash
# åœæ­¢æœåŠ¡
sudo systemctl stop wangyiyun-music

# è§£å‹å¤‡ä»½
tar -xzf wangyiyun-music-backup-20260131.tar.gz -C /

# å¯åŠ¨æœåŠ¡
sudo systemctl start wangyiyun-music
```

### è¿ç§»åˆ°æ–°æœåŠ¡å™¨

```bash
# æ—§æœåŠ¡å™¨ï¼šæ‰“åŒ…
ssh old-server
tar -czf wangyiyun-music.tar.gz /opt/service/wangyiyun-music
scp wangyiyun-music.tar.gz new-server:/tmp/

# æ–°æœåŠ¡å™¨ï¼šè§£å‹
ssh new-server
sudo tar -xzf /tmp/wangyiyun-music.tar.gz -C /opt/service/

# æ–°æœåŠ¡å™¨ï¼šå®‰è£… Javaï¼ˆå¦‚æœªå®‰è£…ï¼‰
sudo apt install openjdk-17-jdk  # Debian/Ubuntu
# æˆ–
sudo yum install java-17-openjdk  # CentOS/RHEL

# æ–°æœåŠ¡å™¨ï¼šé…ç½® systemd å¹¶å¯åŠ¨
# ï¼ˆå‚è€ƒä¸Šæ–‡"æ­¥éª¤ 3ï¼šå¯åŠ¨åº”ç”¨"ï¼‰
```

---

## ğŸ”’ å®‰å…¨å»ºè®®

### 1. ä½¿ç”¨ä¸“ç”¨ç”¨æˆ·ï¼ˆæ¨èï¼‰

```bash
# åˆ›å»ºåº”ç”¨ç”¨æˆ·ï¼ˆä¸å…è®¸ç™»å½•ï¼‰
sudo useradd -r -s /bin/false appuser

# è®¾ç½®ç›®å½•æ‰€æœ‰æƒ
sudo chown -R appuser:appuser /opt/service/wangyiyun-music

# ä¿®æ”¹ systemd æœåŠ¡æ–‡ä»¶
# User=appuser
```

### 2. é™åˆ¶ç›®å½•æƒé™

```bash
# åº”ç”¨æ ¹ç›®å½•ï¼šä»…æ‰€æœ‰è€…å¯è¯»å†™
sudo chmod 750 /opt/service/wangyiyun-music

# æ•°æ®ç›®å½•ï¼šæ‰€æœ‰è€…å’Œç»„å¯è¯»å†™
sudo chmod 770 /opt/service/wangyiyun-music/music-data

# JAR æ–‡ä»¶ï¼šä»…æ‰€æœ‰è€…å¯è¯»
sudo chmod 640 /opt/service/wangyiyun-music/*.jar
```

### 3. é˜²ç«å¢™é…ç½®

```bash
# æ–¹å¼ 1ï¼šufwï¼ˆUbuntu/Debianï¼‰
sudo ufw allow from 192.168.1.0/24 to any port 8910

# æ–¹å¼ 2ï¼šfirewalldï¼ˆCentOS/RHELï¼‰
sudo firewall-cmd --permanent --add-rich-rule='rule family="ipv4" source address="192.168.1.0/24" port protocol="tcp" port="8910" accept'
sudo firewall-cmd --reload

# æ–¹å¼ 3ï¼šiptables
sudo iptables -A INPUT -p tcp -s 192.168.1.0/24 --dport 8910 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8910 -j DROP
```

---

## ğŸ³ Docker éƒ¨ç½²ï¼ˆå¯é€‰ï¼‰

### Dockerfile

```dockerfile
FROM openjdk:17-jdk-slim

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å®‰è£… yt-dlp
RUN apt-get update && \
    apt-get install -y wget python3 && \
    wget https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp -O /app/tools/yt-dlp && \
    chmod +x /app/tools/yt-dlp && \
    apt-get clean && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶åº”ç”¨ JAR
COPY target/wangyiyun-music-*.jar /app/app.jar

# åˆ›å»ºæ•°æ®ç›®å½•
RUN mkdir -p /app/music-data/temp /app/music-data/audio /app/logs

# æš´éœ²ç«¯å£
EXPOSE 8910

# å¯åŠ¨å‘½ä»¤
ENTRYPOINT ["java", "-jar", "/app/app.jar", "--spring.profiles.active=prod"]
```

### docker-compose.yml

```yaml
version: '3.8'

services:
  wangyiyun-music:
    build: ..
    container_name: wangyiyun-music
    ports:
      - "8910:8910"
    volumes:
      # æŒä¹…åŒ–æ•°æ®ç›®å½•
      - ./data/temp:/app/music-data/temp
      - ./data/audio:/app/music-data/audio
      - ./logs:/app/logs
    environment:
      # JVM å‚æ•°
      JAVA_OPTS: "-Xms512m -Xmx2g"
    restart: unless-stopped
```

**å¯åŠ¨å®¹å™¨**ï¼š

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f wangyiyun-music

# åœæ­¢æœåŠ¡
docker-compose down
```

---

## â“ å¸¸è§é—®é¢˜

### Q1: åº”ç”¨å¯åŠ¨åæ‰¾ä¸åˆ°æ•°æ®ç›®å½•ï¼Ÿ

**åŸå› **ï¼šå·¥ä½œç›®å½•è®¾ç½®ä¸æ­£ç¡®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# systemd æœåŠ¡ï¼šç¡®ä¿è®¾ç½® WorkingDirectory
WorkingDirectory=/opt/service/wangyiyun-music

# æ‰‹åŠ¨å¯åŠ¨ï¼šå¿…é¡»å…ˆåˆ‡æ¢åˆ°éƒ¨ç½²ç›®å½•
cd /opt/service/wangyiyun-music
java -jar wangyiyun-music.jar
```

---

### Q2: æç¤º yt-dlp æœªæ‰¾åˆ°ï¼Ÿ

**åŸå› **ï¼šyt-dlp æœªå®‰è£…æˆ–è·¯å¾„ä¸æ­£ç¡®ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# éªŒè¯ yt-dlp æ˜¯å¦å­˜åœ¨
ls -lh /opt/service/wangyiyun-music/tools/yt-dlp

# é‡æ–°ä¸‹è½½
wget https://github.com/yt-dlp/yt-dlp/releases/latest/download/yt-dlp \
  -O /opt/service/wangyiyun-music/tools/yt-dlp
chmod +x /opt/service/wangyiyun-music/tools/yt-dlp

# æµ‹è¯•
/opt/service/wangyiyun-music/tools/yt-dlp --version
```

---

### Q3: ç«¯å£ 8910 è¢«å ç”¨ï¼Ÿ

**è§£å†³æ–¹æ¡ˆ**ï¼š

```bash
# æ–¹å¼ 1ï¼šä¿®æ”¹åº”ç”¨ç«¯å£
# å¯åŠ¨æ—¶æŒ‡å®šç«¯å£
java -jar wangyiyun-music.jar --server.port=8920

# æ–¹å¼ 2ï¼šåœæ­¢å ç”¨ç«¯å£çš„è¿›ç¨‹
# æŸ¥æ‰¾å ç”¨è¿›ç¨‹
sudo lsof -i :8910
# æˆ–
sudo netstat -tlnp | grep 8910

# åœæ­¢è¿›ç¨‹
sudo kill -9 <PID>
```

---

### Q4: å¦‚ä½•æ›´æ–°åº”ç”¨ç‰ˆæœ¬ï¼Ÿ

```bash
# 1. åœæ­¢æœåŠ¡
sudo systemctl stop wangyiyun-music

# 2. å¤‡ä»½æ—§ç‰ˆæœ¬
cd /opt/service/wangyiyun-music
sudo mv wangyiyun-music-0.0.1-SNAPSHOT.jar \
  wangyiyun-music-0.0.1-SNAPSHOT.jar.backup-$(date +%Y%m%d)

# 3. å¤åˆ¶æ–°ç‰ˆæœ¬
sudo cp /path/to/new/wangyiyun-music-0.0.2-SNAPSHOT.jar \
  /opt/service/wangyiyun-music/

# 4. æ›´æ–° systemd æœåŠ¡æ–‡ä»¶ä¸­çš„ JAR æ–‡ä»¶åï¼ˆå¦‚æœ‰å˜åŒ–ï¼‰
sudo vim /etc/systemd/system/wangyiyun-music.service

# 5. é‡è½½é…ç½®å¹¶å¯åŠ¨
sudo systemctl daemon-reload
sudo systemctl start wangyiyun-music

# 6. éªŒè¯
sudo systemctl status wangyiyun-music
```

---

### Q5: å¦‚ä½•æŸ¥çœ‹åº”ç”¨æ—¥å¿—ï¼Ÿ

```bash
# æ–¹å¼ 1ï¼šsystemd æ—¥å¿—
sudo journalctl -u wangyiyun-music -f

# æ–¹å¼ 2ï¼šåº”ç”¨æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚å·²é…ç½®ï¼‰
tail -f /opt/service/wangyiyun-music/logs/application.log

# æ–¹å¼ 3ï¼šæŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
sudo journalctl -u wangyiyun-music -n 100

# æ–¹å¼ 4ï¼šæŸ¥çœ‹é”™è¯¯æ—¥å¿—
sudo journalctl -u wangyiyun-music -p err
```

---

### Q6: æ•°æ®é‡å¾ˆå¤§ï¼Œå¦‚ä½•ä½¿ç”¨ç‹¬ç«‹ç£ç›˜ï¼Ÿ

**æ–¹å¼ 1ï¼šè½¯é“¾æ¥ï¼ˆæ¨èï¼‰**

```bash
# 1. åœ¨å¤§å®¹é‡ç£ç›˜åˆ›å»ºæ•°æ®ç›®å½•
sudo mkdir -p /data/music-storage/temp
sudo mkdir -p /data/music-storage/audio

# 2. åˆ é™¤åŸæœ‰ç›®å½•ï¼Œåˆ›å»ºè½¯é“¾æ¥
cd /opt/service/wangyiyun-music
sudo rm -rf music-data
sudo ln -s /data/music-storage music-data

# 3. å¯åŠ¨åº”ç”¨ï¼ˆæ— éœ€ä¿®æ”¹é…ç½®ï¼‰
sudo systemctl start wangyiyun-music
```

**æ–¹å¼ 2ï¼šç¯å¢ƒå˜é‡**

```bash
# ä¿®æ”¹ systemd æœåŠ¡æ–‡ä»¶
sudo vim /etc/systemd/system/wangyiyun-music.service

# æ·»åŠ ç¯å¢ƒå˜é‡
Environment="MUSIC_TEMP_PATH=/data/music-storage/temp/"
Environment="MUSIC_AUDIO_PATH=file:/data/music-storage/audio/"

# é‡è½½å¹¶é‡å¯
sudo systemctl daemon-reload
sudo systemctl restart wangyiyun-music
```

---

## ğŸ” æ•…éšœæ’æŸ¥

### åº”ç”¨æ— æ³•å¯åŠ¨

```bash
# 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
sudo journalctl -u wangyiyun-music -n 100 --no-pager

# 2. æ£€æŸ¥ Java ç‰ˆæœ¬
java -version  # éœ€è¦ 17+

# 3. æ£€æŸ¥å·¥ä½œç›®å½•
cat /etc/systemd/system/wangyiyun-music.service | grep WorkingDirectory

# 4. æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 8910

# 5. æ‰‹åŠ¨å¯åŠ¨æŸ¥çœ‹é”™è¯¯
cd /opt/service/wangyiyun-music
java -jar wangyiyun-music.jar --spring.profiles.active=prod
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# 1. æ£€æŸ¥æ•°æ®åº“è¿æ¥
mysql -h localhost -u root -p

# 2. æŸ¥çœ‹é…ç½®æ–‡ä»¶ä¸­çš„æ•°æ®åº“é…ç½®
# å¦‚ä½¿ç”¨å¤–éƒ¨é…ç½®æ–‡ä»¶ï¼Œæ£€æŸ¥é…ç½®æ˜¯å¦æ­£ç¡®

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status
```

### æ€§èƒ½é—®é¢˜

```bash
# 1. è°ƒæ•´ JVM å‚æ•°
# ç¼–è¾‘ systemd æœåŠ¡æ–‡ä»¶
Environment="JAVA_OPTS=-Xms1g -Xmx4g -XX:+UseG1GC -XX:MaxGCPauseMillis=200"

# 2. æŸ¥çœ‹ç³»ç»Ÿèµ„æº
top
free -h
df -h

# 3. æŸ¥çœ‹åº”ç”¨çº¿ç¨‹
jps  # è·å– PID
jstack <PID>
```

---

## ğŸ“š é«˜çº§é…ç½®

### ç¯å¢ƒå˜é‡è¦†ç›–ï¼ˆå¯é€‰ï¼‰

å¦‚éœ€è‡ªå®šä¹‰è·¯å¾„ï¼Œå¯ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
# åœ¨ systemd æœåŠ¡æ–‡ä»¶ä¸­æ·»åŠ 
Environment="MUSIC_TEMP_PATH=/custom/path/temp/"
Environment="MUSIC_AUDIO_PATH=file:/custom/path/audio/"

# æˆ–åœ¨å¯åŠ¨è„šæœ¬ä¸­è®¾ç½®
export MUSIC_TEMP_PATH=/custom/path/temp/
export MUSIC_AUDIO_PATH=file:/custom/path/audio/
java -jar wangyiyun-music.jar
```

**å¯ç”¨çš„ç¯å¢ƒå˜é‡**ï¼š

| ç¯å¢ƒå˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|---------|------|--------|
| `MUSIC_TEMP_PATH` | ä¸´æ—¶æ–‡ä»¶è·¯å¾„ | `${user.dir}/music-data/temp/` |
| `MUSIC_AUDIO_PATH` | éŸ³é¢‘æ–‡ä»¶è·¯å¾„ | `file:${user.dir}/music-data/audio/` |
| `SERVER_PORT` | æœåŠ¡ç«¯å£ | `8910` |

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- ğŸ“‹ [é¡¹ç›® AI ä¸Šä¸‹æ–‡](CLAUDE.md) - é¡¹ç›®æ•´ä½“è¯´æ˜
- ğŸ“– [è¯¦ç»†éƒ¨ç½²æ–‡æ¡£](docs/deployment-simple.md) - è¯¦ç»†éƒ¨ç½²æ­¥éª¤
- ğŸš€ [å¿«é€Ÿå‚è€ƒæ‰‹å†Œ](docs/quick-reference.md) - å‘½ä»¤é€ŸæŸ¥
- ğŸ“š [éƒ¨ç½²æ–‡æ¡£å¯¼èˆª](docs/README.md) - æ–‡æ¡£ç´¢å¼•
- ğŸ”§ [è‡ªåŠ¨åŒ–è„šæœ¬](scripts/deploy-simple.sh) - ä¸€é”®éƒ¨ç½²è„šæœ¬
- ğŸ“– [API æ–‡æ¡£](docs/APIæ¥å£æ–‡æ¡£.md) - API æ¥å£è¯´æ˜
- ğŸ¥ [è§†é¢‘è§£æåŠŸèƒ½](docs/è§†é¢‘è§£æåŠŸèƒ½è¯´æ˜.md) - è§†é¢‘è§£æåŠŸèƒ½

---

## ğŸ†˜ è·å–å¸®åŠ©

é‡åˆ°é—®é¢˜ï¼ŸæŒ‰ä»¥ä¸‹é¡ºåºæŸ¥æ‰¾ç­”æ¡ˆï¼š

1. **æŸ¥çœ‹æœ¬æ–‡æ¡£"å¸¸è§é—®é¢˜"ç« èŠ‚**
2. **æŸ¥çœ‹åº”ç”¨æ—¥å¿—**ï¼š`sudo journalctl -u wangyiyun-music -n 100`
3. **æ£€æŸ¥ç›®å½•ç»“æ„**ï¼š`tree -L 2 /opt/service/wangyiyun-music`
4. **éªŒè¯é…ç½®**ï¼šç¡®è®¤å·¥ä½œç›®å½•ã€ç«¯å£ã€æƒé™è®¾ç½®
5. **æäº¤ Issue**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯æ—¥å¿—å’Œç¯å¢ƒä¿¡æ¯

---

## ğŸ“ æ€»ç»“

### ä¸€ä½“åŒ–éƒ¨ç½²çš„æ ¸å¿ƒä¼˜åŠ¿

| ä¼˜åŠ¿ | è¯´æ˜ |
|------|------|
| **æç®€éƒ¨ç½²** | 3 æ­¥å®Œæˆï¼Œæ— éœ€é…ç½®ç¯å¢ƒå˜é‡ |
| **æ˜“äºç†è§£** | æ‰€æœ‰æ–‡ä»¶åœ¨ä¸€ä¸ªç›®å½•ï¼Œç›®å½•ç»“æ„æ¸…æ™° |
| **ä¾¿äºè¿ç§»** | æ•´ä½“æ‰“åŒ…å³å¯è¿ç§»ï¼Œæ— éœ€é‡æ–°é…ç½® |
| **ä¾¿äºå¤‡ä»½** | ä¸€ä¸ªå‘½ä»¤å¤‡ä»½æ‰€æœ‰æ•°æ® |
| **é™ä½é—¨æ§›** | æ–°æ‰‹ä¹Ÿèƒ½å¿«é€Ÿä¸Šæ‰‹ |

### æ¨èä½¿ç”¨åœºæ™¯

- âœ… ä¼ ç»ŸæœåŠ¡å™¨éƒ¨ç½²
- âœ… ä¸­å°è§„æ¨¡åº”ç”¨ï¼ˆæ•°æ®é‡ < 100GBï¼‰
- âœ… å¿«é€ŸåŸå‹éªŒè¯
- âœ… å›¢é˜Ÿå¼€å‘æµ‹è¯•

### ä½•æ—¶è€ƒè™‘å…¶ä»–æ–¹æ¡ˆ

- æ•°æ®é‡è¶…å¤§ï¼ˆTB çº§ï¼‰ï¼Œéœ€è¦ç‹¬ç«‹ç£ç›˜ â†’ ä½¿ç”¨è½¯é“¾æ¥æˆ–ç¯å¢ƒå˜é‡
- å®¹å™¨åŒ–éƒ¨ç½² â†’ ä½¿ç”¨ Docker
- äº‘åŸç”Ÿç¯å¢ƒ â†’ ä½¿ç”¨ Kubernetes

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æ›´æ–°æ—¶é—´**: 2026-01-31
**ç»´æŠ¤è€…**: naruto
**åé¦ˆå»ºè®®**: æ¬¢è¿æäº¤ Issue æˆ– Pull Request
