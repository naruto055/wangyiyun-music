# API æµ‹è¯•æŒ‡å—

**åˆ›å»ºæ—¶é—´**: 2026-01-24
**é¡¹ç›®**: ç½‘æ˜“äº‘éŸ³ä¹åç«¯ç³»ç»Ÿ

---

## ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡

### 1. å¯åŠ¨åº”ç”¨

**æ–¹å¼ 1: IDE è¿è¡Œ**
- åœ¨ IntelliJ IDEA ä¸­æ‰¾åˆ° `WangyiyunMusicApplication.java`
- å³é”® â†’ Run 'WangyiyunMusicApplication'

**æ–¹å¼ 2: Maven å‘½ä»¤**
```bash
mvn spring-boot:run
```

**æ–¹å¼ 3: JAR åŒ…è¿è¡Œ**
```bash
mvn clean package
java -jar target/wangyiyun-music-0.0.1-SNAPSHOT.jar
```

**å¯åŠ¨æˆåŠŸæ ‡å¿—**: æ§åˆ¶å°è¾“å‡º "Started WangyiyunMusicApplication"
**è®¿é—®åœ°å€**: http://localhost:8910

---

## ğŸµ API æ¥å£æ¸…å•

### 1. éŸ³ä¹åˆ—è¡¨æŸ¥è¯¢

**æ¥å£**: `GET /api/music/list`
**åŠŸèƒ½**: åˆ†é¡µæŸ¥è¯¢éŸ³ä¹ï¼Œæ”¯æŒåˆ†ç±»ç­›é€‰ã€å…³é”®è¯æœç´¢ã€æ’åº

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|------|------|
| pageNum | Integer | å¦ | é¡µç  | 1 |
| pageSize | Integer | å¦ | æ¯é¡µå¤§å° | 10 |
| categoryId | Long | å¦ | åˆ†ç±»ID | 1 |
| keyword | String | å¦ | å…³é”®è¯ï¼ˆæ­Œæ›²åï¼‰ | æ™´å¤© |
| sortField | String | å¦ | æ’åºå­—æ®µ(play_count/create_time) | play_count |
| sortOrder | String | å¦ | æ’åºæ–¹å¼(asc/desc) | desc |

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# ç”¨ä¾‹ 1: æŸ¥è¯¢æ‰€æœ‰éŸ³ä¹ï¼ˆåˆ†é¡µï¼‰
curl -X GET "http://localhost:8910/api/music/list?pageNum=1&pageSize=10"

# ç”¨ä¾‹ 2: æŒ‰æ’­æ”¾é‡é™åºæ’åº
curl -X GET "http://localhost:8910/api/music/list?sortField=play_count&sortOrder=desc"

# ç”¨ä¾‹ 3: æœç´¢å…³é”®è¯"æ™´å¤©"
curl -X GET "http://localhost:8910/api/music/list?keyword=æ™´å¤©"

# ç”¨ä¾‹ 4: æŸ¥è¯¢åˆ†ç±»ID=1çš„éŸ³ä¹
curl -X GET "http://localhost:8910/api/music/list?categoryId=1"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "records": [
      {
        "id": 1,
        "title": "æ™´å¤©",
        "duration": 269,
        "playCount": 15678,
        "favoriteCount": 3245,
        ...
      }
    ],
    "total": 6,
    "size": 10,
    "current": 1,
    "pages": 1
  }
}
```

---

### 2. éŸ³ä¹è¯¦æƒ…æŸ¥è¯¢

**æ¥å£**: `GET /api/music/{id}`
**åŠŸèƒ½**: è·å–éŸ³ä¹è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…å«æ­Œæ‰‹ã€ä¸“è¾‘ã€åˆ†ç±»ã€æ ‡ç­¾ç­‰

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| id | Long | éŸ³ä¹ID |

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# æŸ¥è¯¢ID=1çš„éŸ³ä¹è¯¦æƒ…
curl -X GET "http://localhost:8910/api/music/1"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "id": 1,
    "title": "æ™´å¤©",
    "duration": 269,
    "fileUrl": "http://music.example.com/sunny_day.mp3",
    "coverUrl": "http://music.example.com/covers/sunny_day.jpg",
    "lyrics": "æ•…äº‹çš„å°é»„èŠ±...",
    "playCount": 15678,
    "favoriteCount": 3245,
    "releaseDate": "2003-07-31",
    "albumName": "å¶æƒ ç¾",
    "categoryName": "æµè¡Œ",
    "artists": [
      {
        "id": 1,
        "name": "å‘¨æ°ä¼¦",
        "role": "singer"
      }
    ],
    "tags": ["åè¯­", "æŠ’æƒ…", "ç»å…¸", "æ ¡å›­"]
  }
}
```

---

### 3. è®°å½•æ’­æ”¾

**æ¥å£**: `POST /api/play-record`
**åŠŸèƒ½**: è®°å½•éŸ³ä¹æ’­æ”¾å¹¶è‡ªåŠ¨æ›´æ–°æ’­æ”¾æ¬¡æ•°

**è¯·æ±‚ä½“**:
```json
{
  "musicId": 1,
  "playDuration": 180,
  "playSource": "web"
}
```

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# è®°å½•æ’­æ”¾
curl -X POST "http://localhost:8910/api/play-record" \
  -H "Content-Type: application/json" \
  -d '{"musicId": 1, "playDuration": 180, "playSource": "web"}'
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

**éªŒè¯**: å†æ¬¡æŸ¥è¯¢éŸ³ä¹è¯¦æƒ…ï¼Œ`playCount` åº”è¯¥ +1

---

### 4. æŸ¥è¯¢æ’­æ”¾å†å²

**æ¥å£**: `GET /api/play-record/history`
**åŠŸèƒ½**: æŸ¥è¯¢ç”¨æˆ·æ’­æ”¾å†å²è®°å½•ï¼ˆåˆ†é¡µï¼‰

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|------|--------|
| pageNum | Integer | å¦ | é¡µç  | 1 |
| pageSize | Integer | å¦ | æ¯é¡µå¤§å° | 10 |

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# æŸ¥è¯¢æ’­æ”¾å†å²
curl -X GET "http://localhost:8910/api/play-record/history?pageNum=1&pageSize=10"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "records": [
      {
        "id": 1,
        "musicId": 1,
        "userId": 0,
        "playDuration": 180,
        "playSource": "web",
        "createTime": "2026-01-24T15:30:00"
      }
    ],
    "total": 4,
    "size": 10,
    "current": 1
  }
}
```

---

### 5. æ”¶è—éŸ³ä¹

**æ¥å£**: `POST /api/favorite/{musicId}`
**åŠŸèƒ½**: æ”¶è—éŸ³ä¹å¹¶è‡ªåŠ¨æ›´æ–°æ”¶è—æ¬¡æ•°

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| musicId | Long | éŸ³ä¹ID |

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# æ”¶è—ID=1çš„éŸ³ä¹
curl -X POST "http://localhost:8910/api/favorite/1"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

**éªŒè¯**: å†æ¬¡æŸ¥è¯¢éŸ³ä¹è¯¦æƒ…ï¼Œ`favoriteCount` åº”è¯¥ +1

**é‡å¤æ”¶è—æµ‹è¯•**:
```bash
# å†æ¬¡æ”¶è—åŒä¸€é¦–æ­Œ
curl -X POST "http://localhost:8910/api/favorite/1"
```

**é¢„æœŸå“åº”**ï¼ˆé”™è¯¯ï¼‰:
```json
{
  "code": 500,
  "message": "å·²æ”¶è—è¯¥éŸ³ä¹",
  "data": null
}
```

---

### 6. æŸ¥è¯¢æ”¶è—åˆ—è¡¨

**æ¥å£**: `GET /api/favorite/list`
**åŠŸèƒ½**: æŸ¥è¯¢ç”¨æˆ·æ”¶è—çš„éŸ³ä¹åˆ—è¡¨ï¼ˆåˆ†é¡µï¼‰

**è¯·æ±‚å‚æ•°**:
| å‚æ•° | ç±»å‹ | å¿…å¡« | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|------|------|--------|
| pageNum | Integer | å¦ | é¡µç  | 1 |
| pageSize | Integer | å¦ | æ¯é¡µå¤§å° | 10 |

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# æŸ¥è¯¢æ”¶è—åˆ—è¡¨
curl -X GET "http://localhost:8910/api/favorite/list?pageNum=1&pageSize=10"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": {
    "records": [
      {
        "id": 1,
        "musicId": 1,
        "userId": 0,
        "isDeleted": 0,
        "createTime": "2026-01-24T15:30:00"
      }
    ],
    "total": 2,
    "size": 10,
    "current": 1
  }
}
```

---

### 7. å–æ¶ˆæ”¶è—

**æ¥å£**: `DELETE /api/favorite/{musicId}`
**åŠŸèƒ½**: å–æ¶ˆæ”¶è—ï¼ˆé€»è¾‘åˆ é™¤ï¼‰å¹¶è‡ªåŠ¨æ›´æ–°æ”¶è—æ¬¡æ•°

**è·¯å¾„å‚æ•°**:
| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| musicId | Long | éŸ³ä¹ID |

**æµ‹è¯•ç”¨ä¾‹**:

```bash
# å–æ¶ˆæ”¶è—ID=1çš„éŸ³ä¹
curl -X DELETE "http://localhost:8910/api/favorite/1"
```

**é¢„æœŸå“åº”**:
```json
{
  "code": 200,
  "message": "æ“ä½œæˆåŠŸ",
  "data": null
}
```

**éªŒè¯**:
1. å†æ¬¡æŸ¥è¯¢æ”¶è—åˆ—è¡¨ï¼Œè¯¥è®°å½•åº”è¯¥æ¶ˆå¤±
2. æŸ¥è¯¢éŸ³ä¹è¯¦æƒ…ï¼Œ`favoriteCount` åº”è¯¥ -1

---

## ğŸ§ª å®Œæ•´æµ‹è¯•æµç¨‹

### æµç¨‹ 1: éŸ³ä¹æ’­æ”¾æµç¨‹

```bash
# 1. æŸ¥è¯¢éŸ³ä¹åˆ—è¡¨
curl -X GET "http://localhost:8910/api/music/list"

# 2. è·å–éŸ³ä¹è¯¦æƒ…ï¼ˆè®°å½•åˆå§‹æ’­æ”¾æ¬¡æ•°ï¼‰
curl -X GET "http://localhost:8910/api/music/1"

# 3. è®°å½•æ’­æ”¾
curl -X POST "http://localhost:8910/api/play-record" \
  -H "Content-Type: application/json" \
  -d '{"musicId": 1, "playDuration": 269, "playSource": "web"}'

# 4. éªŒè¯æ’­æ”¾æ¬¡æ•°å¢åŠ 
curl -X GET "http://localhost:8910/api/music/1"

# 5. æŸ¥è¯¢æ’­æ”¾å†å²
curl -X GET "http://localhost:8910/api/play-record/history"
```

### æµç¨‹ 2: éŸ³ä¹æ”¶è—æµç¨‹

```bash
# 1. æ”¶è—éŸ³ä¹
curl -X POST "http://localhost:8910/api/favorite/1"

# 2. éªŒè¯æ”¶è—æ¬¡æ•°å¢åŠ 
curl -X GET "http://localhost:8910/api/music/1"

# 3. æŸ¥è¯¢æ”¶è—åˆ—è¡¨
curl -X GET "http://localhost:8910/api/favorite/list"

# 4. å–æ¶ˆæ”¶è—
curl -X DELETE "http://localhost:8910/api/favorite/1"

# 5. éªŒè¯æ”¶è—æ¬¡æ•°å‡å°‘
curl -X GET "http://localhost:8910/api/music/1"
```

---

## âœ… éªŒè¯æ¸…å•

å®Œæ•´æµ‹è¯•åï¼Œç¡®è®¤ä»¥ä¸‹åŠŸèƒ½æ­£å¸¸ï¼š

- [ ] éŸ³ä¹åˆ—è¡¨æŸ¥è¯¢ï¼ˆåˆ†é¡µæ­£å¸¸ï¼‰
- [ ] éŸ³ä¹åˆ—è¡¨æœç´¢ï¼ˆå…³é”®è¯ç”Ÿæ•ˆï¼‰
- [ ] éŸ³ä¹åˆ—è¡¨æ’åºï¼ˆæŒ‰æ’­æ”¾é‡/åˆ›å»ºæ—¶é—´ï¼‰
- [ ] éŸ³ä¹è¯¦æƒ…æŸ¥è¯¢ï¼ˆåŒ…å«æ­Œæ‰‹ã€ä¸“è¾‘ã€æ ‡ç­¾ï¼‰
- [ ] æ’­æ”¾è®°å½•åŠŸèƒ½ï¼ˆæ’­æ”¾æ¬¡æ•°è‡ªåŠ¨+1ï¼‰
- [ ] æ’­æ”¾å†å²æŸ¥è¯¢ï¼ˆåˆ†é¡µæ­£å¸¸ï¼‰
- [ ] æ”¶è—åŠŸèƒ½ï¼ˆæ”¶è—æ¬¡æ•°è‡ªåŠ¨+1ï¼‰
- [ ] æ”¶è—åˆ—è¡¨æŸ¥è¯¢ï¼ˆåˆ†é¡µæ­£å¸¸ï¼‰
- [ ] å–æ¶ˆæ”¶è—åŠŸèƒ½ï¼ˆæ”¶è—æ¬¡æ•°è‡ªåŠ¨-1ï¼‰
- [ ] é‡å¤æ”¶è—æ ¡éªŒï¼ˆæç¤º"å·²æ”¶è—è¯¥éŸ³ä¹"ï¼‰
- [ ] å¼‚å¸¸å¤„ç†ï¼ˆéŸ³ä¹ä¸å­˜åœ¨ã€å‚æ•°æ ¡éªŒç­‰ï¼‰

---

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1: å¯åŠ¨å¤±è´¥ - æ•°æ®åº“è¿æ¥é”™è¯¯

**é”™è¯¯ä¿¡æ¯**: `Cannot create connection to database server`

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ MySQL å·²å¯åŠ¨
2. æ£€æŸ¥ `application.yaml` ä¸­çš„æ•°æ®åº“è¿æ¥ä¿¡æ¯
3. ç¡®è®¤æ•°æ®åº“ `wangyiyun-music` å·²åˆ›å»º

### é—®é¢˜ 2: æ¥å£è¿”å› 404

**é”™è¯¯ä¿¡æ¯**: `404 Not Found`

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤ URL è·¯å¾„æ­£ç¡®ï¼ˆæ³¨æ„ `/api` å‰ç¼€ï¼‰
2. ç¡®è®¤åº”ç”¨å·²æˆåŠŸå¯åŠ¨
3. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯æ—¥å¿—

### é—®é¢˜ 3: æ¥å£è¿”å› 500 - ç©ºæŒ‡é’ˆå¼‚å¸¸

**é”™è¯¯ä¿¡æ¯**: `NullPointerException`

**è§£å†³æ–¹æ¡ˆ**:
1. ç¡®è®¤æµ‹è¯•æ•°æ®å·²å¯¼å…¥ï¼ˆ`docs/sql/test_data.sql`ï¼‰
2. æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰æ•°æ®
3. æŸ¥çœ‹æ§åˆ¶å°è¯¦ç»†é”™è¯¯å †æ ˆ

---

## ğŸ“Š æµ‹è¯•æ•°æ®è¯´æ˜

æµ‹è¯•æ•°æ®åŒ…å«ï¼š
- **6 é¦–æ­Œæ›²**: æ™´å¤©ã€ä¸ƒé‡Œé¦™ã€ç¨»é¦™ã€æ±Ÿå—ã€çº¢è±†ã€æ¼”å‘˜
- **5 ä½æ­Œæ‰‹**: å‘¨æ°ä¼¦ã€æ—ä¿Šæ°ã€é™ˆå¥•è¿…ã€é‚“ç´«æ£‹ã€è–›ä¹‹è°¦
- **5 å¼ ä¸“è¾‘**: Jayã€èŒƒç‰¹è¥¿ã€å¶æƒ ç¾ã€å…«åº¦ç©ºé—´ã€JJé™†
- **6 ä¸ªåˆ†ç±»**: æµè¡Œã€æ‘‡æ»šã€å¤å…¸ã€æ°‘è°£ã€ç”µå­ã€è¯´å”±
- **8 ä¸ªæ ‡ç­¾**: åè¯­ã€æŠ’æƒ…ã€å¿«æ­Œã€ç»å…¸ã€æ€€æ—§ã€æ ¡å›­ã€æ²»æ„ˆã€åŠ±å¿—

**é»˜è®¤ userId**: æ‰€æœ‰æ¥å£æš‚æ—¶ä½¿ç”¨ `userId=0`ï¼Œåç»­é›†æˆç”¨æˆ·ç³»ç»Ÿåæ›¿æ¢ã€‚

---

**æµ‹è¯•å®Œæˆåï¼Œè¯·è®°å½•ä»»ä½•å‘ç°çš„é—®é¢˜æˆ–æ”¹è¿›å»ºè®®ã€‚**
